<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roz≈°√≠≈ôen√° interaktivn√≠ hern√≠ mapa</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 100vw;
            min-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: clamp(1.5em, 4vw, 2.2em);
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .instructions {
            text-align: center;
            margin-bottom: 10px;
            font-size: clamp(0.9em, 2vw, 1.1em);
            opacity: 0.9;
            flex-shrink: 0;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
        }

        .legend-color.own { background: #3498db; }
        .legend-color.abandoned { background: #ecf0f1; }
        .legend-color.neutral { background: #9b59b6; }
        .legend-color.ally { background: #27ae60; }
        .legend-color.enemy { background: #e74c3c; }

        .global-unit-indicator {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            font-size: clamp(1em, 2.5vw, 1.3em);
            font-weight: bold;
            color: #f39c12;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .global-unit-indicator.changing {
            transform: scale(1.05);
            background: rgba(231, 76, 60, 0.8);
        }

        .map-container {
            position: relative;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 800px;
            height: 500px;
            margin: 0 auto;
            overflow: hidden;
            cursor: grab;
            border: 3px solid #3498db;
            flex: 0 0 auto;
        }

        .map-container.dragging {
            cursor: grabbing;
        }

        .map-content {
            position: relative;
            width: 3000px;
            height: 3000px;
            transition: transform 0.3s ease;
            background-image: 
                linear-gradient(to right, rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 100px 100px;
        }

        .context-menu {
            position: fixed;
            background: rgba(0,0,0,0.9);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            z-index: 1000;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.2s ease;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        .context-menu.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .context-menu-item {
            padding: 8px 15px;
            color: #ecf0f1;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            font-size: 14px;
        }

        .context-menu-item:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .army-detail-window {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            border-radius: 15px;
            padding: 15px 20px;
            width: calc(100% - 80px);
            max-width: 700px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            z-index: 1001;
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            backdrop-filter: blur(15px);
            border: 2px solid #3498db;
        }

        .army-detail-window.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .army-detail-header {
            font-size: 1.3em;
            color: #3498db;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #34495e;
            padding-bottom: 10px;
        }

        .army-detail-categories {
            display: flex;
            gap: 15px;
            justify-content: space-between;
        }

        .army-detail-category {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 8px;
            border-left: 3px solid #3498db;
            transition: all 0.2s ease;
            text-align: center;
        }

        .army-detail-category:hover {
            border-left-color: #f39c12;
            transform: translateY(-2px);
        }

        .army-detail-type {
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .army-detail-count {
            font-size: 1.4em;
            color: #ecf0f1;
            font-weight: bold;
        }

        .army-detail-description {
            font-size: 0.75em;
            color: #bdc3c7;
            font-style: italic;
            margin-top: 3px;
        }

        .province {
            position: absolute;
            border: 2px solid;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            width: 80px;
            height: 80px;
        }

        /* Vlastn√≠ dr≈æavy (modr√©) */
        .province.own {
            border-color: #3498db;
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .province.own:hover {
            transform: scale(1.05);
            border-color: #5dade2;
            background: linear-gradient(135deg, #5dade2, #3498db);
            box-shadow: 0 6px 20px rgba(93, 173, 226, 0.4);
            animation: pulse 1.5s infinite;
        }

        .province.own.selected {
            border-color: #f1c40f;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.5);
        }

        /* Opu≈°tƒõn√© dr≈æavy (b√≠l√©) */
        .province.abandoned {
            border-color: #bdc3c7;
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(236, 240, 241, 0.3);
        }

        .province.abandoned:hover {
            transform: scale(1.02);
            border-color: #d5dbdb;
            background: linear-gradient(135deg, #f8f9fa, #ecf0f1);
            box-shadow: 0 6px 20px rgba(213, 219, 219, 0.4);
        }

        .province.abandoned.selected {
            border-color: #f1c40f;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #2c3e50;
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.5);
        }

        /* Neutr√°ln√≠ dr≈æavy (fialov√©) */
        .province.neutral {
            border-color: #8e44ad;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
        }

        .province.neutral:hover {
            transform: scale(1.02);
            border-color: #bb8fce;
            background: linear-gradient(135deg, #bb8fce, #9b59b6);
            box-shadow: 0 6px 20px rgba(187, 143, 206, 0.4);
        }

        .province.neutral.selected {
            border-color: #f1c40f;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.5);
        }

        /* Spojeneck√© dr≈æavy (zelen√©) */
        .province.ally {
            border-color: #27ae60;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .province.ally:hover {
            transform: scale(1.02);
            border-color: #58d68d;
            background: linear-gradient(135deg, #58d68d, #2ecc71);
            box-shadow: 0 6px 20px rgba(88, 214, 141, 0.4);
        }

        .province.ally.selected {
            border-color: #f1c40f;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.5);
        }

        /* Nep≈ô√°telsk√© dr≈æavy (ƒçerven√©) */
        .province.enemy {
            border-color: #c0392b;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .province.enemy:hover {
            transform: scale(1.02);
            border-color: #ec7063;
            background: linear-gradient(135deg, #ec7063, #e74c3c);
            box-shadow: 0 6px 20px rgba(236, 112, 99, 0.4);
        }

        .province.enemy.selected {
            border-color: #f1c40f;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.5);
        }

        .province-name {
            font-size: 0.85em;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            line-height: 1.1;
        }

        .unit-count-display {
            font-size: 1.4em;
            font-weight: bold;
            color: #f39c12;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-top: 5px;
            transition: all 0.3s ease;
        }

        .unit-type-indicator {
            font-size: 0.9em;
            color: #ecf0f1;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .scroll-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            color: #95a5a6;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .scroll-indicator.visible {
            opacity: 1;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Roz≈°√≠≈ôen√° interaktivn√≠ hern√≠ mapa</h1>
        </div>
        
        <div class="instructions">
            Scrolluj koleƒçkem nad mapou pro prohl√≠≈æen√≠ vojensk√Ωch jednotek vlastn√≠ch dr≈æav | Ta≈æen√≠m pohybuj po gridu 30x30 | Detail okno se zav≈ôe pouze p≈ôi kliknut√≠ na jinou dr≈æavu
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color own"></div>
                <span>Vlastn√≠ dr≈æavy</span>
            </div>
            <div class="legend-item">
                <div class="legend-color abandoned"></div>
                <span>Opu≈°tƒõn√© dr≈æavy</span>
            </div>
            <div class="legend-item">
                <div class="legend-color neutral"></div>
                <span>Neutr√°ln√≠ dr≈æavy</span>
            </div>
            <div class="legend-item">
                <div class="legend-color ally"></div>
                <span>Spojeneck√© dr≈æavy</span>
            </div>
            <div class="legend-item">
                <div class="legend-color enemy"></div>
                <span>Nep≈ô√°telsk√© dr≈æavy</span>
            </div>
        </div>

        <div class="global-unit-indicator" id="globalUnitIndicator">
            üó°Ô∏è Zobrazuji: <span id="currentUnitType">OFF (√ötoƒçn√© jednotky)</span>
        </div>

        <div class="map-container">
            <div class="map-content" id="mapContent">
                <!-- Vlastn√≠ dr≈æavy -->
                <div class="province own" data-name="Severn√≠ kr√°lovstv√≠" data-type="own">
                    <div class="province-name">Severn√≠ kr√°lovstv√≠</div>
                    <div class="unit-type-indicator" id="unitType-1">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-1">0</div>
                </div>
                <div class="province own" data-name="V√Ωchodn√≠ √∫dol√≠" data-type="own">
                    <div class="province-name">V√Ωchodn√≠ √∫dol√≠</div>
                    <div class="unit-type-indicator" id="unitType-2">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-2">0</div>
                </div>
                <div class="province own" data-name="Horsk√© k≈ô√≠dlo" data-type="own">
                    <div class="province-name">Horsk√© k≈ô√≠dlo</div>
                    <div class="unit-type-indicator" id="unitType-3">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-3">0</div>
                </div>
                <div class="province own" data-name="Pob≈ôe≈æn√≠ pevnost" data-type="own">
                    <div class="province-name">Pob≈ôe≈æn√≠ pevnost</div>
                    <div class="unit-type-indicator" id="unitType-4">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-4">0</div>
                </div>
                <div class="province own" data-name="Ji≈æn√≠ pl√°nƒõ" data-type="own">
                    <div class="province-name">Ji≈æn√≠ pl√°nƒõ</div>
                    <div class="unit-type-indicator" id="unitType-5">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-5">0</div>
                </div>
                <div class="province own" data-name="Centr√°ln√≠ ba≈°ta" data-type="own">
                    <div class="province-name">Centr√°ln√≠ ba≈°ta</div>
                    <div class="unit-type-indicator" id="unitType-6">‚öîÔ∏è OFF</div>
                    <div class="unit-count-display" id="unitCount-6">0</div>
                </div>

                <!-- Opu≈°tƒõn√© dr≈æavy -->
                <div class="province abandoned" data-name="Opu≈°tƒõn√° dr≈æava" data-type="abandoned">
                    <div class="province-name">Opu≈°tƒõn√° dr≈æava</div>
                </div>
                <div class="province abandoned" data-name="Opu≈°tƒõn√° dr≈æava" data-type="abandoned">
                    <div class="province-name">Opu≈°tƒõn√° dr≈æava</div>
                </div>
                <div class="province abandoned" data-name="Opu≈°tƒõn√° dr≈æava" data-type="abandoned">
                    <div class="province-name">Opu≈°tƒõn√° dr≈æava</div>
                </div>
                <div class="province abandoned" data-name="Opu≈°tƒõn√° dr≈æava" data-type="abandoned">
                    <div class="province-name">Opu≈°tƒõn√° dr≈æava</div>
                </div>

                <!-- Neutr√°ln√≠ dr≈æavy -->
                <div class="province neutral" data-name="Svobodn√© mƒõsto Kamenograd" data-type="neutral">
                    <div class="province-name">Svobodn√© mƒõsto Kamenograd</div>
                </div>
                <div class="province neutral" data-name="Obchodn√≠ spoleƒçenstv√≠ Zlat√Ω mostek" data-type="neutral">
                    <div class="province-name">Obchodn√≠ spoleƒçenstv√≠ Zlat√Ω mostek</div>
                </div>
                <div class="province neutral" data-name="Neutr√°ln√≠ z√≥na St≈ô√≠brn√© jezero" data-type="neutral">
                    <div class="province-name">Neutr√°ln√≠ z√≥na St≈ô√≠brn√© jezero</div>
                </div>
                <div class="province neutral" data-name="≈òemeslnick√Ω cech ≈Ωelezn√Ω d≈Øl" data-type="neutral">
                    <div class="province-name">≈òemeslnick√Ω cech ≈Ωelezn√Ω d≈Øl</div>
                </div>
                <div class="province neutral" data-name="Voln√° republika B√≠l√© vrcholy" data-type="neutral">
                    <div class="province-name">Voln√° republika B√≠l√© vrcholy</div>
                </div>

                <!-- Spojeneck√© dr≈æavy -->
                <div class="province ally" data-name="Spojen√© kingdom Zelen√Ω h√°j" data-type="ally">
                    <div class="province-name">Spojen√© kingdom Zelen√Ω h√°j</div>
                </div>
                <div class="province ally" data-name="Aliance K≈ôi≈°≈•√°lov√Ωch jezer" data-type="ally">
                    <div class="province-name">Aliance K≈ôi≈°≈•√°lov√Ωch jezer</div>
                </div>
                <div class="province ally" data-name="Bratrsk√° unie Zlat√© pl√°nƒõ" data-type="ally">
                    <div class="province-name">Bratrsk√° unie Zlat√© pl√°nƒõ</div>
                </div>
                <div class="province ally" data-name="Spojeneck√Ω basti√≥n Smaragdov√© √∫tesy" data-type="ally">
                    <div class="province-name">Spojeneck√Ω basti√≥n Smaragdov√© √∫tesy</div>
                </div>
                <div class="province ally" data-name="P≈ô√°telsk√© kr√°lovstv√≠ Jasn√° hvƒõzda" data-type="ally">
                    <div class="province-name">P≈ô√°telsk√© kr√°lovstv√≠ Jasn√° hvƒõzda</div>
                </div>

                <!-- Nep≈ô√°telsk√© dr≈æavy -->
                <div class="province enemy" data-name="Temn√© imp√©rium ƒåerven√© slunce" data-type="enemy">
                    <div class="province-name">Temn√© imp√©rium ƒåerven√© slunce</div>
                </div>
                <div class="province enemy" data-name="V√°leƒçn√° horda ƒåern√© kop√≠" data-type="enemy">
                    <div class="province-name">V√°leƒçn√° horda ƒåern√© kop√≠</div>
                </div>
                <div class="province enemy" data-name="Krvav√° ≈ô√≠≈°e ≈Ωelezn√Ω pƒõst" data-type="enemy">
                    <div class="province-name">Krvav√° ≈ô√≠≈°e ≈Ωelezn√Ω pƒõst</div>
                </div>
                <div class="province enemy" data-name="Barbarsk√Ω klan Rud√© vlky" data-type="enemy">
                    <div class="province-name">Barbarsk√Ω klan Rud√© vlky</div>
                </div>
                <div class="province enemy" data-name="Invazn√≠ s√≠ly Temn√Ω √∫svit" data-type="enemy">
                    <div class="province-name">Invazn√≠ s√≠ly Temn√Ω √∫svit</div>
                </div>
                <div class="province enemy" data-name="Nep≈ô√°telsk√° citadela Krvav√Ω meƒç" data-type="enemy">
                    <div class="province-name">Nep≈ô√°telsk√° citadela Krvav√Ω meƒç</div>
                </div>

                <div class="scroll-indicator" id="scrollIndicator">
                    üñ±Ô∏è Scrolluj koleƒçkem kdekoliv nad gridem pro zmƒõnu zobrazen√Ωch jednotek | Ta≈æen√≠m pohybuj po mapƒõ
                </div>
            </div>

            <div class="context-menu" id="contextMenu">
                <div class="context-menu-item" onclick="centerMap()">üéØ Vycentrovat mapu</div>
            </div>

            <div class="army-detail-window" id="armyDetailWindow">
                <div class="army-detail-header" id="armyDetailHeader">Detail arm√°dy</div>
                
                <!-- Obsah pro vlastn√≠ dr≈æavy - vojensk√© jednotky -->
                <div class="army-detail-categories" id="armyDetailMilitary">
                    <div class="army-detail-category">
                        <div class="army-detail-type">‚öîÔ∏è OFF</div>
                        <div class="army-detail-count" id="armyDetailOff">0</div>
                        <div class="army-detail-description">√ötoƒçn√© jednotky</div>
                    </div>
                    <div class="army-detail-category">
                        <div class="army-detail-type">üõ°Ô∏è DEFF</div>
                        <div class="army-detail-count" id="armyDetailDeff">0</div>
                        <div class="army-detail-description">Obrann√© jednotky</div>
                    </div>
                    <div class="army-detail-category">
                        <div class="army-detail-type">üè∞ SIEGE</div>
                        <div class="army-detail-count" id="armyDetailSiege">0</div>
                        <div class="army-detail-description">Obl√©hac√≠ jednotky</div>
                    </div>
                    <div class="army-detail-category">
                        <div class="army-detail-type">‚ú® SPEC</div>
                        <div class="army-detail-count" id="armyDetailSpec">0</div>
                        <div class="army-detail-description">Speci√°ln√≠ jednotky</div>
                    </div>
                </div>
                
                <!-- Obsah pro ciz√≠ dr≈æavy - informace o hr√°ƒçi a alianci -->
                <div class="army-detail-categories" id="armyDetailDiplomacy" style="display: none;">
                    <div class="army-detail-category" style="flex: 1;">
                        <div class="army-detail-type">üë§ VL√ÅDCE</div>
                        <div class="army-detail-count" id="armyDetailPlayer" style="font-size: 1.1em;">-</div>
                        <div class="army-detail-description">Kdo vl√°dne t√©to dr≈æav</div>
                    </div>
                    <div class="army-detail-category" style="flex: 1;">
                        <div class="army-detail-type">ü§ù ALIANCE</div>
                        <div class="army-detail-count" id="armyDetailAlliance" style="font-size: 1.1em;">-</div>
                        <div class="army-detail-description">Diplomatick√© spojenectv√≠</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hern√≠ data pouze pro vlastn√≠ dr≈æavy
        const gameData = {
            'Severn√≠ kr√°lovstv√≠': {
                OFF: Math.floor(Math.random() * 500) + 100,
                DEFF: Math.floor(Math.random() * 400) + 150,
                SIEGE: Math.floor(Math.random() * 100) + 20,
                SPEC: Math.floor(Math.random() * 80) + 10
            },
            'V√Ωchodn√≠ √∫dol√≠': {
                OFF: Math.floor(Math.random() * 350) + 80,
                DEFF: Math.floor(Math.random() * 300) + 120,
                SIEGE: Math.floor(Math.random() * 80) + 15,
                SPEC: Math.floor(Math.random() * 60) + 8
            },
            'Horsk√© k≈ô√≠dlo': {
                OFF: Math.floor(Math.random() * 450) + 120,
                DEFF: Math.floor(Math.random() * 380) + 160,
                SIEGE: Math.floor(Math.random() * 70) + 12,
                SPEC: Math.floor(Math.random() * 90) + 15
            },
            'Pob≈ôe≈æn√≠ pevnost': {
                OFF: Math.floor(Math.random() * 400) + 90,
                DEFF: Math.floor(Math.random() * 450) + 180,
                SIEGE: Math.floor(Math.random() * 120) + 25,
                SPEC: Math.floor(Math.random() * 70) + 12
            },
            'Ji≈æn√≠ pl√°nƒõ': {
                OFF: Math.floor(Math.random() * 600) + 150,
                DEFF: Math.floor(Math.random() * 350) + 100,
                SIEGE: Math.floor(Math.random() * 90) + 18,
                SPEC: Math.floor(Math.random() * 100) + 20
            },
            'Centr√°ln√≠ ba≈°ta': {
                OFF: Math.floor(Math.random() * 550) + 140,
                DEFF: Math.floor(Math.random() * 500) + 200,
                SIEGE: Math.floor(Math.random() * 110) + 22,
                SPEC: Math.floor(Math.random() * 85) + 18
            }
        };

        // Data o hr√°ƒç√≠ch a alic√≠ch pro ciz√≠ dr≈æavy
        const playerData = {
            // Opu≈°tƒõn√© dr≈æavy
            'Opu≈°tƒõn√° dr≈æava': {
                player: 'Opu≈°tƒõno',
                alliance: '≈Ω√°dn√°'
            },
            
            // Neutr√°ln√≠ dr≈æavy
            'Svobodn√© mƒõsto Kamenograd': {
                player: 'Starosta Kamil Stonavsk√Ω',
                alliance: 'Nez√°visl√© obce'
            },
            'Obchodn√≠ spoleƒçenstv√≠ Zlat√Ω mostek': {
                player: 'Zlatoslav Obchodn√≠k',
                alliance: 'Nez√°visl√© obce'
            },
            'Neutr√°ln√≠ z√≥na St≈ô√≠brn√© jezero': {
                player: 'Rada star≈°√≠ch',
                alliance: 'Nez√°visl√© obce'
            },
            '≈òemeslnick√Ω cech ≈Ωelezn√Ω d≈Øl': {
                player: 'Mistr Kov√°≈ô ≈Ωelenda',
                alliance: 'Nez√°visl√© obce'
            },
            'Voln√° republika B√≠l√© vrcholy': {
                player: 'Prezident Vrcholn√Ω',
                alliance: 'Nez√°visl√© obce'
            },
            
            // Spojeneck√© dr≈æavy
            'Spojen√© kingdom Zelen√Ω h√°j': {
                player: 'Kr√°l Zeloslav Moudr√Ω',
                alliance: 'Severn√≠ pakt'
            },
            'Aliance K≈ôi≈°≈•√°lov√Ωch jezer': {
                player: 'Velkoknƒõ≈æna K≈ôi≈°≈•√°la',
                alliance: 'Severn√≠ pakt'
            },
            'Bratrsk√° unie Zlat√© pl√°nƒõ': {
                player: 'Bratr Zlatoslav',
                alliance: 'Severn√≠ pakt'
            },
            'Spojeneck√Ω basti√≥n Smaragdov√© √∫tesy': {
                player: 'Admir√°l Smaragd',
                alliance: 'Severn√≠ pakt'
            },
            'P≈ô√°telsk√© kr√°lovstv√≠ Jasn√° hvƒõzda': {
                player: 'Kr√°lovna Hvƒõzdiƒçka',
                alliance: 'Severn√≠ pakt'
            },
            
            // Nep≈ô√°telsk√© dr≈æavy
            'Temn√© imp√©rium ƒåerven√© slunce': {
                player: 'C√≠sa≈ô Temnotlav Krvav√Ω',
                alliance: 'Osa zla'
            },
            'V√°leƒçn√° horda ƒåern√© kop√≠': {
                player: 'N√°ƒçeln√≠k Kop√≠slav Brut√°ln√≠',
                alliance: 'Osa zla'
            },
            'Krvav√° ≈ô√≠≈°e ≈Ωelezn√Ω pƒõst': {
                player: 'Dikt√°tor ≈Ωelezoslav Tyranƒçiƒç',
                alliance: 'Osa zla'
            },
            'Barbarsk√Ω klan Rud√© vlky': {
                player: 'V≈Ødce smeƒçky Vlƒçeslav',
                alliance: 'Osa zla'
            },
            'Invazn√≠ s√≠ly Temn√Ω √∫svit': {
                player: 'Gener√°l √ösvitoslav Temn√Ω',
                alliance: 'Osa zla'
            },
            'Nep≈ô√°telsk√° citadela Krvav√Ω meƒç': {
                player: 'Komand√©r Meƒçislav Bezl√≠tostn√Ω',
                alliance: 'Osa zla'
            }
        };

        // Glob√°ln√≠ promƒõnn√©
        let currentUnitType = 0; // 0: OFF, 1: DEFF, 2: SIEGE, 3: SPEC
        let scrollTimeout = null;
        let lastScrollTime = 0;
        let selectedProvince = null; // Pro tracking vybran√© dr≈æavy
        const unitTypes = ['OFF', 'DEFF', 'SIEGE', 'SPEC'];
        const unitIcons = ['‚öîÔ∏è', 'üõ°Ô∏è', 'üè∞', '‚ú®'];
        const unitNames = ['OFF (√ötoƒçn√© jednotky)', 'DEFF (Obrann√© jednotky)', 'SIEGE (Obl√©hac√≠ jednotky)', 'SPEC (Speci√°ln√≠ jednotky)'];
        const scrollDelay = 200;

        // Elementy
        const globalUnitIndicator = document.getElementById('globalUnitIndicator');
        const currentUnitTypeDisplay = document.getElementById('currentUnitType');
        const scrollIndicator = document.getElementById('scrollIndicator');
        const provinces = document.querySelectorAll('.province');
        const ownProvinces = document.querySelectorAll('.province.own');
        const mapContainer = document.querySelector('.map-container');
        const mapContent = document.getElementById('mapContent');
        const contextMenu = document.getElementById('contextMenu');
        const armyDetailWindow = document.getElementById('armyDetailWindow');

        // Web Audio API pro jednoduch√© zvukov√© efekty
        let audioContext = null;
        
        // Inicializace audio contextu po prvn√≠m kliknut√≠ u≈æivatele
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Funkce pro vytvo≈ôen√≠ jednoduch√Ωch zvuk≈Ø pomoc√≠ Web Audio API
        function playSound(type) {
            initAudio();
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // R≈Øzn√© frekvence a d√©lky pro r≈Øzn√© zvuky
            switch(type) {
                case 'hover':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'click':
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'military':
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(500, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'scroll':
                    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.05);
                    gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
            }
        }

        // Drag and drop promƒõnn√©
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let mapX = 0;
        let mapY = 0;
        let initialMapX = 0;
        let initialMapY = 0;
        let clickedProvince = null;
        let dragDistance = 0; // Pro mƒõ≈ôen√≠ vzd√°lenosti draggingu
        let wasDraggingInThisSession = false; // Pamatuje si, jestli do≈°lo k draggingu v t√©to mouse session

        // Grid nastaven√≠
        const GRID_SIZE = 30;
        const CELL_SIZE = 100;
        const PROVINCE_SIZE = 80;

        // Funkce pro v√Ωpoƒçet grid sou≈ôadnic a aktualizaci n√°zv≈Ø
        function updateProvinceNamesWithCoordinates() {
            provinces.forEach(province => {
                const pixelX = parseInt(province.style.left);
                const pixelY = parseInt(province.style.top);
                
                // V√Ωpoƒçet grid sou≈ôadnic (od 1 do 30)
                const gridX = Math.round(pixelX / CELL_SIZE) + 1;
                const gridY = Math.round(pixelY / CELL_SIZE) + 1;
                
                // Z√≠sk√°n√≠ p≈Øvodn√≠ho n√°zvu ze data-name
                const originalName = province.getAttribute('data-name');
                
                // Aktualizace zobrazen√©ho n√°zvu s sou≈ôadnicemi
                const nameElement = province.querySelector('.province-name');
                if (nameElement) {
                    nameElement.textContent = `${originalName} (${gridX}/${gridY})`;
                }
            });
        }

        // Funkce pro strategick√© rozm√≠stƒõn√≠ dr≈æav do skupin
        function strategicProvincePositions() {
            const usedPositions = new Set();
            
            // Definice oblast√≠ pro jednotliv√© typy dr≈æav
            const regions = {
                own: { xStart: 12, xEnd: 18, yStart: 12, yEnd: 18 }, // St≈ôed - vlastn√≠ √∫zem√≠
                ally: { xStart: 8, xEnd: 22, yStart: 8, yEnd: 22 }, // Kolem vlastn√≠ho √∫zem√≠
                neutral: { xStart: 5, xEnd: 25, yStart: 5, yEnd: 25 }, // ≈†ir≈°√≠ oblast
                enemy: { xStart: 0, xEnd: 30, yStart: 0, yEnd: 30 }, // Hranice a rohy
                abandoned: { xStart: 3, xEnd: 27, yStart: 3, yEnd: 27 } // N√°hodnƒõ rozpt√Ωlen√©
            };

            // Funkce pro z√≠sk√°n√≠ n√°hodn√© pozice v oblasti
            function getRandomPositionInRegion(region) {
                let gridX, gridY, position;
                let attempts = 0;
                
                do {
                    gridX = Math.floor(Math.random() * (region.xEnd - region.xStart)) + region.xStart;
                    gridY = Math.floor(Math.random() * (region.yEnd - region.yStart)) + region.yStart;
                    position = `${gridX},${gridY}`;
                    attempts++;
                } while (usedPositions.has(position) && attempts < 100);
                
                if (attempts >= 100) {
                    // Fallback - najdi jakoukoli volnou pozici
                    do {
                        gridX = Math.floor(Math.random() * GRID_SIZE);
                        gridY = Math.floor(Math.random() * GRID_SIZE);
                        position = `${gridX},${gridY}`;
                    } while (usedPositions.has(position));
                }
                
                return { gridX, gridY, position };
            }

            // Rozm√≠stƒõn√≠ vlastn√≠ch dr≈æav (st≈ôedov√© pozice)
            ownProvinces.forEach(province => {
                const { gridX, gridY, position } = getRandomPositionInRegion(regions.own);
                usedPositions.add(position);
                
                const pixelX = gridX * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                const pixelY = gridY * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                
                province.style.left = `${pixelX}px`;
                province.style.top = `${pixelY}px`;
            });

            // Rozm√≠stƒõn√≠ spojeneck√Ωch dr≈æav (kolem vlastn√≠ch)
            const allyProvinces = document.querySelectorAll('.province.ally');
            allyProvinces.forEach(province => {
                const { gridX, gridY, position } = getRandomPositionInRegion(regions.ally);
                usedPositions.add(position);
                
                const pixelX = gridX * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                const pixelY = gridY * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                
                province.style.left = `${pixelX}px`;
                province.style.top = `${pixelY}px`;
            });

            // Rozm√≠stƒõn√≠ neutr√°ln√≠ch dr≈æav
            const neutralProvinces = document.querySelectorAll('.province.neutral');
            neutralProvinces.forEach(province => {
                const { gridX, gridY, position } = getRandomPositionInRegion(regions.neutral);
                usedPositions.add(position);
                
                const pixelX = gridX * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                const pixelY = gridY * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                
                province.style.left = `${pixelX}px`;
                province.style.top = `${pixelY}px`;
            });

            // Rozm√≠stƒõn√≠ opu≈°tƒõn√Ωch dr≈æav
            const abandonedProvinces = document.querySelectorAll('.province.abandoned');
            abandonedProvinces.forEach(province => {
                const { gridX, gridY, position } = getRandomPositionInRegion(regions.abandoned);
                usedPositions.add(position);
                
                const pixelX = gridX * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                const pixelY = gridY * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                
                province.style.left = `${pixelX}px`;
                province.style.top = `${pixelY}px`;
            });

            // Rozm√≠stƒõn√≠ nep≈ô√°telsk√Ωch dr≈æav (preferovanƒõ na hranic√≠ch)
            const enemyProvinces = document.querySelectorAll('.province.enemy');
            enemyProvinces.forEach(province => {
                let { gridX, gridY, position } = getRandomPositionInRegion(regions.enemy);
                
                // Preferuj pozice na hranic√≠ch gridu
                if (Math.random() < 0.7) {
                    const borderChoice = Math.floor(Math.random() * 4);
                    switch(borderChoice) {
                        case 0: // Horn√≠ hranice
                            gridY = Math.floor(Math.random() * 3);
                            break;
                        case 1: // Doln√≠ hranice  
                            gridY = GRID_SIZE - 1 - Math.floor(Math.random() * 3);
                            break;
                        case 2: // Lev√° hranice
                            gridX = Math.floor(Math.random() * 3);
                            break;
                        case 3: // Prav√° hranice
                            gridX = GRID_SIZE - 1 - Math.floor(Math.random() * 3);
                            break;
                    }
                    position = `${gridX},${gridY}`;
                    
                    // Pokud je pozice obsazen√°, pou≈æij p≈Øvodn√≠ n√°hodnou
                    if (usedPositions.has(position)) {
                        ({ gridX, gridY, position } = getRandomPositionInRegion(regions.enemy));
                    }
                }
                
                usedPositions.add(position);
                
                const pixelX = gridX * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                const pixelY = gridY * CELL_SIZE + (CELL_SIZE - PROVINCE_SIZE) / 2;
                
                province.style.left = `${pixelX}px`;
                province.style.top = `${pixelY}px`;
            });
        }

        // Funkce pro zobrazen√≠ detailu arm√°dy nebo informac√≠ o dr≈æav
        function showArmyDetail(province) {
            // Pokud jsme bƒõhem draggingu, ignoruj kliknut√≠
            if (isDragging) {
                return;
            }
            
            const provinceType = province.getAttribute('data-type');
            const provinceName = province.getAttribute('data-name');
            
            // Pokud klik√°m na stejnou dr≈æavu, kter√° je u≈æ vybran√°, nedƒõlej nic
            if (selectedProvince === province) {
                return;
            }
            
            // Z√≠sk√°n√≠ sou≈ôadnic
            const pixelX = parseInt(province.style.left);
            const pixelY = parseInt(province.style.top);
            const gridX = Math.round(pixelX / CELL_SIZE) + 1;
            const gridY = Math.round(pixelY / CELL_SIZE) + 1;
            
            // N√°zev s sou≈ôadnicemi
            const nameWithCoords = `${provinceName} (${gridX}/${gridY})`;
            
            // Odeber selected t≈ô√≠du z p≈ôedchoz√≠ vybran√© dr≈æavy
            if (selectedProvince) {
                selectedProvince.classList.remove('selected');
            }
            
            // Nastav novou vybranou dr≈æavu
            selectedProvince = province;
            province.classList.add('selected');
            
            // Zobraz detail pro vlastn√≠ nebo ciz√≠ dr≈æavy
            if (provinceType === 'own') {
                // Vlastn√≠ dr≈æavy - zobraz vojensk√© jednotky
                const data = gameData[provinceName];
                if (!data) return;
                
                document.getElementById('armyDetailHeader').textContent = nameWithCoords;
                document.getElementById('armyDetailOff').textContent = data.OFF;
                document.getElementById('armyDetailDeff').textContent = data.DEFF;
                document.getElementById('armyDetailSiege').textContent = data.SIEGE;
                document.getElementById('armyDetailSpec').textContent = data.SPEC;
                
                // Zobraz vojensk√© informace, skryj diplomatick√©
                document.getElementById('armyDetailMilitary').style.display = 'flex';
                document.getElementById('armyDetailDiplomacy').style.display = 'none';
            } else {
                // Ciz√≠ dr≈æavy - zobraz informace o hr√°ƒçi a alianci
                const data = playerData[provinceName];
                if (!data) return;
                
                document.getElementById('armyDetailHeader').textContent = nameWithCoords;
                document.getElementById('armyDetailPlayer').textContent = data.player;
                document.getElementById('armyDetailAlliance').textContent = data.alliance;
                
                // Zobraz diplomatick√© informace, skryj vojensk√©
                document.getElementById('armyDetailMilitary').style.display = 'none';
                document.getElementById('armyDetailDiplomacy').style.display = 'flex';
            }
            
            armyDetailWindow.classList.add('visible');
        }
        
        function hideArmyDetail() {
            // Pokud jsme bƒõhem draggingu, NIKDY nezav√≠rej detail okno
            if (isDragging) {
                return;
            }
            
            // Odeber selected t≈ô√≠du z vybran√© dr≈æavy
            if (selectedProvince) {
                selectedProvince.classList.remove('selected');
                selectedProvince = null;
            }
            
            armyDetailWindow.classList.remove('visible');
        }

        function throttle(func, delay) {
            let timeoutId;
            let lastExecTime = 0;
            return function (...args) {
                const currentTime = Date.now();
                
                if (currentTime - lastExecTime > delay) {
                    func.apply(this, args);
                    lastExecTime = currentTime;
                } else {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => {
                        func.apply(this, args);
                        lastExecTime = Date.now();
                    }, delay - (currentTime - lastExecTime));
                }
            };
        }

        // Funkce pro aktualizaci zobrazen√≠ pouze vlastn√≠ch provinci√≠
        function updateOwnProvinces(unitTypeIndex) {
            const unitType = unitTypes[unitTypeIndex];
            const unitIcon = unitIcons[unitTypeIndex];
            const unitName = unitNames[unitTypeIndex];
            
            currentUnitTypeDisplay.textContent = unitName;
            globalUnitIndicator.classList.add('changing');
            
            setTimeout(() => {
                globalUnitIndicator.classList.remove('changing');
            }, 300);

            // Aktualizace pouze vlastn√≠ch provinci√≠
            ownProvinces.forEach((province, index) => {
                const provinceName = province.getAttribute('data-name');
                const data = gameData[provinceName];
                
                if (data) {
                    const unitTypeElement = document.getElementById(`unitType-${index + 1}`);
                    const unitCountElement = document.getElementById(`unitCount-${index + 1}`);
                    
                    if (unitTypeElement && unitCountElement) {
                        unitTypeElement.textContent = `${unitIcon} ${unitType}`;
                        unitCountElement.textContent = data[unitType];
                        
                        // Animace zmƒõny
                        unitCountElement.style.transform = 'scale(1.2)';
                        unitCountElement.style.color = '#e74c3c';
                        
                        setTimeout(() => {
                            unitCountElement.style.transform = 'scale(1)';
                            unitCountElement.style.color = '#f39c12';
                        }, 200);
                    }
                }
            });
        }

        // Throttled scroll handler
        const throttledScroll = throttle((delta) => {
            const currentTime = Date.now();
            
            if (currentTime - lastScrollTime < scrollDelay) {
                return;
            }
            
            lastScrollTime = currentTime;
            
            if (delta > 0) {
                currentUnitType = (currentUnitType + 1) % unitTypes.length;
            } else {
                currentUnitType = (currentUnitType - 1 + unitTypes.length) % unitTypes.length;
            }
            
            updateOwnProvinces(currentUnitType);
        }, 100);

        // Event listener pro scrollov√°n√≠
        mapContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            const delta = e.deltaY;
            throttledScroll(delta);
            playSound('scroll');
        });

        // Hover efekty a klik√°n√≠ pro v≈°echny provincie
        provinces.forEach(province => {
            const provinceType = province.getAttribute('data-type');
            
            // Hover zvuk pro wszystkie typy dr≈æav
            province.addEventListener('mouseenter', () => {
                if (!isDragging && !wasDraggingInThisSession) { // Jen pokud netah√°m mapu
                    playSound('hover');
                }
            });
            
            // Context menu pro v≈°echny typy dr≈æav
            province.addEventListener('contextmenu', (e) => {
                if (!isDragging && !wasDraggingInThisSession) { // Jen pokud netah√°m mapu
                    e.preventDefault();
                    clickedProvince = province;
                    contextMenu.style.left = `${e.clientX}px`;
                    contextMenu.style.top = `${e.clientY}px`;
                    contextMenu.classList.add('visible');
                    playSound('click');
                }
            });
            
            // Detail p≈ôi kliknut√≠ pro v≈°echny typy dr≈æav
            province.addEventListener('click', (e) => {
                if (!isDragging && !wasDraggingInThisSession) { // Jen pokud netah√°m mapu
                    e.stopPropagation();
                    showArmyDetail(province);
                    
                    // R≈Øzn√© zvuky podle typu dr≈æavy
                    if (provinceType === 'own') {
                        playSound('military');
                    } else {
                        playSound('click');
                    }
                }
            });
        });

        // Drag and drop funkcionalita
        mapContainer.addEventListener('mousedown', (e) => {
            if (e.button === 0) {
                isDragging = true;
                wasDraggingInThisSession = false; // Reset na zaƒç√°tku nov√© mouse session
                dragDistance = 0; // Reset vzd√°lenosti
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                initialMapX = mapX;
                initialMapY = mapY;
                mapContainer.classList.add('dragging');
                mapContent.style.transition = 'none';
                e.preventDefault();
            }
        });

        mapContainer.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaX = (e.clientX - dragStartX) * 2.0;
                const deltaY = (e.clientY - dragStartY) * 2.0;
                
                // Vypoƒç√≠tej celkovou vzd√°lenost pohybu
                dragDistance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                // Pokud se mapa posunula o v√≠ce ne≈æ 5px, oznaƒç√≠me to jako skuteƒçn√Ω dragging
                if (dragDistance > 5) {
                    wasDraggingInThisSession = true;
                }
                
                mapX = initialMapX + deltaX;
                mapY = initialMapY + deltaY;
                mapContent.style.transform = `translate(${mapX}px, ${mapY}px)`;
            }
        });

        document.addEventListener('mouseup', (e) => {
            if (isDragging) {
                isDragging = false;
                mapContainer.classList.remove('dragging');
                mapContent.style.transition = 'transform 0.3s ease';
                
                // Po kr√°tk√© dobƒõ resetuj wasDraggingInThisSession
                // (d√°v√°me ƒças na to, aby se click eventy stihly vyhodnotit)
                setTimeout(() => {
                    wasDraggingInThisSession = false;
                }, 50);
            }
        });

        mapContainer.addEventListener('mouseleave', () => {
            if (isDragging) {
                isDragging = false;
                mapContainer.classList.remove('dragging');
                mapContent.style.transition = 'transform 0.3s ease';
                
                setTimeout(() => {
                    wasDraggingInThisSession = false;
                }, 50);
            }
        });

        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target)) {
                contextMenu.classList.remove('visible');
                clickedProvince = null;
            }
            
            if (!armyDetailWindow.contains(e.target) && !e.target.closest('.province')) {
                hideArmyDetail();
            }
        });

        // Funkce pro vycentrov√°n√≠ mapy
        function centerMap() {
            playSound('click');
            
            if (clickedProvince) {
                const rect = clickedProvince.getBoundingClientRect();
                const containerRect = mapContainer.getBoundingClientRect();
                
                const provinceX = rect.left + rect.width / 2 - containerRect.left;
                const provinceY = rect.top + rect.height / 2 - containerRect.top;
                
                const containerCenterX = containerRect.width / 2;
                const containerCenterY = containerRect.height / 2;
                
                mapX = mapX + (containerCenterX - provinceX);
                mapY = mapY + (containerCenterY - provinceY);
                
                mapContent.style.transform = `translate(${mapX}px, ${mapY}px)`;
                clickedProvince = null;
            } else {
                const gridCenterX = (GRID_SIZE * CELL_SIZE) / 2;
                const gridCenterY = (GRID_SIZE * CELL_SIZE) / 2;
                const containerCenterX = mapContainer.offsetWidth / 2;
                const containerCenterY = mapContainer.offsetHeight / 2;
                
                mapX = containerCenterX - gridCenterX;
                mapY = containerCenterY - gridCenterY;
                mapContent.style.transform = `translate(${mapX}px, ${mapY}px)`;
            }
            contextMenu.classList.remove('visible');
        }

        // Inicializace
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéÆ Roz≈°√≠≈ôen√° hern√≠ mapa naƒçtena!');
            console.log('üìä Naƒçteno', Object.keys(gameData).length, 'vlastn√≠ch dr≈æav s vojensk√Ωmi daty');
            console.log('üåç Naƒçteno', Object.keys(playerData).length, 'ciz√≠ch dr≈æav s diplomatick√Ωmi informacemi');
            console.log('üèõÔ∏è Celkem', provinces.length, 'dr≈æav v≈°ech typ≈Ø');
            console.log('üåê Grid syst√©m:', GRID_SIZE + 'x' + GRID_SIZE, 'ƒçtvereƒçk≈Ø');
            console.log('üîä Zvukov√© efekty aktivn√≠ (hover, click, scroll, military)');
            
            // Strategick√© rozm√≠stƒõn√≠ dr≈æav
            strategicProvincePositions();
            
            // Aktualizace n√°zv≈Ø s grid sou≈ôadnicemi
            updateProvinceNamesWithCoordinates();
            
            // Vycentrov√°n√≠ na st≈ôed gridu
            centerMap();
            
            // Inicializace zobrazen√≠ vlastn√≠ch provinci√≠
            updateOwnProvinces(currentUnitType);
            
            // Zobrazen√≠ scroll indik√°toru
            scrollIndicator.classList.add('visible');
            
            // Inicializace audio p≈ôi prvn√≠m kliknut√≠
            document.addEventListener('click', initAudio, { once: true });
        });
    </script>
</body>
</html>